import streamlit as st
import pandas as pd
import matplotlib.pyplot as plt

# -----------------------------
# ุจูุงูุงุช ุงูุฅุฏุงุฑุงุช ุงูุชุนููููุฉ
# -----------------------------
data = {
    "ุงูุฅุฏุงุฑุฉ": ["ุฃุณูุงู", "ุฏุฑุงู", "ูุตุฑ", "ููู ุฃูุจู", "ุฅุฏูู"],
    "ุนุฏุฏ ุงููุฏุงุฑุณ": [85, 21, 43, 77, 106],
    "ุนุฏุฏ ุงููุตูู": [756, 193, 216, 719, 742],
    "ุนุฏุฏ ุงูุทูุงุจ": [30225, 8014, 7617, 29003, 28140]
}

df = pd.DataFrame(data)
df["ูุซุงูุฉ ุงููุตู"] = df["ุนุฏุฏ ุงูุทูุงุจ"] / df["ุนุฏุฏ ุงููุตูู"]

# -----------------------------
# ูุงุฌูุฉ ุงูุชุทุจูู
# -----------------------------
st.set_page_config(page_title="ููุญุฉ ูุคุดุฑุงุช ุงููุฑุญูุฉ ุงูุฅุนุฏุงุฏูุฉ โ ุฃุณูุงู", layout="wide")
st.title("๐ ููุญุฉ ูุคุดุฑุงุช ุงููุฑุญูุฉ ุงูุฅุนุฏุงุฏูุฉ โ ูุญุงูุธุฉ ุฃุณูุงู")

# ุงุฎุชูุงุฑ ุงูุฅุฏุงุฑุฉ
admin = st.selectbox("ุงุฎุชุฑ ุงูุฅุฏุงุฑุฉ ุงูุชุนููููุฉ:", ["ุงููู"] + list(df["ุงูุฅุฏุงุฑุฉ"]))

if admin != "ุงููู":
    df_view = df[df["ุงูุฅุฏุงุฑุฉ"] == admin]
else:
    df_view = df

# -----------------------------
# ูุคุดุฑุงุช ุฑูููุฉ
# -----------------------------
col1, col2, col3 = st.columns(3)
col1.metric("๐ซ ุนุฏุฏ ุงููุฏุงุฑุณ", int(df_view["ุนุฏุฏ ุงููุฏุงุฑุณ"].sum()))
col2.metric("๐ ุนุฏุฏ ุงููุตูู", int(df_view["ุนุฏุฏ ุงููุตูู"].sum()))
col3.metric("๐จโ๐ ุนุฏุฏ ุงูุทูุงุจ", int(df_view["ุนุฏุฏ ุงูุทูุงุจ"].sum()))

st.divider()

# -----------------------------
# ุฑุณู: ุนุฏุฏ ุงูุทูุงุจ ุญุณุจ ุงูุฅุฏุงุฑุฉ
# -----------------------------
st.subheader("๐ ููุงุฑูุฉ ุงูุฅุฏุงุฑุงุช ุญุณุจ ุนุฏุฏ ุงูุทูุงุจ")
fig1 = plt.figure()
plt.bar(df_view["ุงูุฅุฏุงุฑุฉ"], df_view["ุนุฏุฏ ุงูุทูุงุจ"])
plt.title("ุนุฏุฏ ุงูุทูุงุจ")
st.pyplot(fig1)

# -----------------------------
# ุฑุณู: ูุซุงูุฉ ุงููุตูู
# -----------------------------
st.subheader("๐ ูุซุงูุฉ ุงูุทูุงุจ ููู ูุตู")
fig2 = plt.figure()
plt.bar(df_view["ุงูุฅุฏุงุฑุฉ"], df_view["ูุซุงูุฉ ุงููุตู"])
plt.axhline(40, linestyle="--")
plt.title("ูุซุงูุฉ ุงููุตู")
st.pyplot(fig2)

# -----------------------------
# Heatmap ูููุซุงูุงุช
# -----------------------------
st.subheader("๐ฅ Heatmap ูููุซุงูุงุช")
fig3 = plt.figure()
plt.imshow([df["ูุซุงูุฉ ุงููุตู"]])
plt.yticks([])
plt.xticks(range(len(df["ุงูุฅุฏุงุฑุฉ"])), df["ุงูุฅุฏุงุฑุฉ"])
plt.colorbar()
st.pyplot(fig3)

# -----------------------------
# ูุคุดุฑุงุช ุงูุชุญุฐูุฑ
# -----------------------------
st.subheader("๐ฆ ูุคุดุฑุงุช ุงูุชุญุฐูุฑ")
def traffic_light(x):
    if x >= 40:
        return "๐ด ูุฑุชูุน"
    elif x >= 35:
        return "๐ก ูุชูุณุท"
    else:
        return "๐ข ุขูู"

df["ูุคุดุฑ"] = df["ูุซุงูุฉ ุงููุตู"].apply(traffic_light)
st.dataframe(df[["ุงูุฅุฏุงุฑุฉ", "ูุซุงูุฉ ุงููุตู", "ูุคุดุฑ"]])

# -----------------------------
# ุชุฑุชูุจ ุงูุฅุฏุงุฑุงุช ุญุณุจ ุงูุนุจุก
# -----------------------------
st.subheader("๐ ุชุฑุชูุจ ุงูุฅุฏุงุฑุงุช ูู ุงูุฃุนูู ุฅูู ุงูุฃูู ุนุจุฆูุง")
df_sorted = df.sort_values("ูุซุงูุฉ ุงููุตู", ascending=False)
st.table(df_sorted[["ุงูุฅุฏุงุฑุฉ", "ูุซุงูุฉ ุงููุตู"]])
